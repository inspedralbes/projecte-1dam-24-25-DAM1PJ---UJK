<!-- views/admin/view_logs.ejs -->
<%- include('../partials/header', { title: title }) %>

<div class="container mt-4">
    <h1><%= title %></h1>

    <% if (error) { %>
        <div class="alert alert-danger"><%= error %></div>
    <% } %>

    <form method="GET" action="/admin/logs" class="mb-3">
        <div class="input-group">
            <input type="text" name="search" class="form-control" placeholder="Buscar en logs..." value="<%= searchTerm %>">
            <button class="btn btn-outline-primary" type="submit">Buscar</button>
            <% if (searchTerm) { %>
                 <a href="/admin/logs" class="btn btn-outline-secondary">Limpiar</a>
            <% } %>
        </div>
    </form>

    <% if (logs && logs.length > 0) { %>
        <table class="table table-striped table-hover table-sm">
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>Nivel</th>
                    <th>Usuario</th>
                    <th>Método</th>
                    <th>URL</th>
                    <th>Status</th>
                    <th>IP</th>
                    <th>User Agent</th>
                    <th>Mensaje</th>
                </tr>
            </thead>
            <tbody>
                <% logs.forEach(log => { %>
                    <tr>
                        <td><%= new Date(log.timestamp).toLocaleString() %></td>
                        <td><span class="badge bg-<%= log.level === 'ERROR' ? 'danger' : (log.level === 'WARN' ? 'warning' : 'info') %>"><%= log.level %></span></td>
                        <td><%= log.username %><% if (log.userId) { %>(ID: <%= log.userId %>)<% } %></td>
                        <td><%= log.method %></td>
                        <td style="max-width: 200px; overflow-wrap: break-word;"><%= log.url %></td>
                        <td><%= log.statusCode %></td>
                        <td><%= log.ip %></td>
                        <td style="max-width: 200px; font-size: 0.8em; overflow-wrap: break-word;"><%= log.userAgent %></td>
                        <td style="max-width: 300px; overflow-wrap: break-word;"><%= log.message %></td>
                    </tr>
                <% }); %>
            </tbody>
        </table>

        <!-- Paginación -->
        <% if (totalPages > 1) { %>
            <nav aria-label="Paginación de logs">
                <ul class="pagination">
                    <% if (currentPage > 1) { %>
                        <li class="page-item"><a class="page-link" href="/admin/logs?page=<%= currentPage - 1 %>&search=<%= searchTerm %>&limit=<%= limit %>">Anterior</a></li>
                    <% } %>
                    <% for (let i = 1; i <= totalPages; i++) { %>
                        <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                            <a class="page-link" href="/admin/logs?page=<%= i %>&search=<%= searchTerm %>&limit=<%= limit %>"><%= i %></a>
                        </li>
                    <% } %>
                    <% if (currentPage < totalPages) { %>
                        <li class="page-item"><a class="page-link" href="/admin/logs?page=<%= currentPage + 1 %>&search=<%= searchTerm %>&limit=<%= limit %>">Siguiente</a></li>
                    <% } %>
                </ul>
            </nav>
        <% } %>

    <% } else if (!error) { %>
        <p>No hay logs para mostrar.</p>
    <% } %>

    <p><a href="/index" class="btn btn-secondary mt-3">Volver al Panel Principal</a></p>
</div>

<%- include('../partials/footer') %>