<%- include('../partials/header', { title: 'Afegir incidència' }) %>

<div class="d-flex justify-content-center my-5">
  <div class="col-lg-8 col-md-10">
    <div class="card shadow-sm">
      <div class="card-header bg-dark text-white">Nova Incidència</div>
      <div class="card-body">
        <form action="/incidencies/create" method="POST">

          <div class="mb-3">
            <label for="id_tipus" class="form-label">Tipus</label>
            <select name="id_tipus" id="id_tipus" class="form-control" required>
              <option value="">-- Selecciona un tipus --</option>
              <% if (typeof tipusList !== 'undefined' && tipusList && tipusList.length > 0) { %>
                <% tipusList.forEach(tipus => { %>
                  <option value="<%= tipus.id_tipus %>">
                    <%= tipus.nom %>
                  </option>
                <% }) %>
              <% } else { %>
                <option value="" disabled>No hi ha tipus disponibles</option>
              <% } %>
            </select>
          </div>

          <div class="mb-3">
            <label for="descripcio" class="form-label">Descripció</label>
            <textarea name="descripcio" id="descripcio" class="form-control" required></textarea>
          </div>

          <div class="mb-3">
            <label for="datetime_creada" class="form-label">Data i hora de creació</label>
            <input type="datetime-local" name="datetime_creada" id="datetime_creada" class="form-control" required />
          </div>

          <div class="mb-3">
            <label for="id_departament" class="form-label">Departament</label>
            <select name="id_departament" id="id_departament" class="form-control" required>
              <option value="">-- Selecciona un departament --</option>
              <% if (typeof departaments !== 'undefined' && departaments && departaments.length > 0) { %>
                <% departaments.forEach(dept => { %>
                  <option value="<%= dept.id_departament %>">
                    <%= dept.id_departament %> - <%= dept.nom %>
                  </option>
                <% }) %>
              <% } else { %>
                <option value="" disabled>No hi ha departaments disponibles</option>
              <% } %>
            </select>
          </div>

          <div class="mb-3">
            <label for="estat" class="form-label">Estat</label>
            <select name="estat" id="estat" class="form-control" required>
              <option value="Oberta">Oberta</option>
              <option value="En procés">En procés</option>
              <option value="Tancada">Tancada</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="prioritat" class="form-label">Prioritat</label>
            <select name="prioritat" id="prioritat" class="form-control" required>
              <option value="Baixa">Baixa</option>
              <option value="Mitjana">Mitjana</option>
              <option value="Alta">Alta</option>
              <option value="Crítica">Crítica</option>
            </select>
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-success">
              <i class="bi bi-send-fill me-2"></i>Crear Incidència
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
